{% extends "_base.html" %}

{% block title %}Tweets{% endblock %}

{% block content_title %}Tweets{% endblock %}

{% block css %}
    <!-- Custom Fonts -->
    <link href="{{ url_for('static', filename='font-awesome/css/font-awesome.min.css') }}" rel="stylesheet"
          type="text/css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.18/c3.min.css"
          integrity="sha256-rp5Udclt95vV/qBRPHck2jUp/0xytxZgbHCCVRqV9vc=" crossorigin="anonymous"/>

    <link rel="stylesheet" href="//cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css"/>
{% endblock %}


{% block content %}
    <div class="row">
        <div class="col-sm-4 col-sm-offset-3">
            <h3>Top users</h3>
        </div>
        <div class="clearfix"></div>
        <div class="col-sm-4 col-md-3 col-lg-2">
            <table id="dt_top_users" class="table display compact" cellspacing="0" width="100%">
            </table>
        </div>
        <div class="col-sm-8 col-md-9 col-lg-10">
            <div class="chart-container">
                <div class="chart" id="c3_top_users"></div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascript %}
    <!-- Load D3.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"
            integrity="sha256-dsOXGNHAo/syFnazt+KTBsCQeRmlcW1XKL0bCK4Baec=" crossorigin="anonymous"></script>

    <!-- Load C3.js  -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.18/c3.min.js"
            integrity="sha256-rx6BHKxiLgSA2BslVk0Gq+bclIxvxBm4eDKxvpS+7wI=" crossorigin="anonymous"></script>


    <script type="text/javascript" src="//cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript"
            src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment-with-locales.min.js"></script>
    <script>
        var json_data;
        $(document).ready(function () {

            $.getJSON("api/user", function (data) {
                num_results = data.num_results.toLocaleString('en', {useGrouping: true})
                $('#total_users').html(num_results);
            });


            $.getJSON("api/hashtag", function (data) {
                num_results = data.num_results.toLocaleString('en', {useGrouping: true})
                $('#total_hashtags').html(num_results);
            });

            $.getJSON("ajax_topusers", function (data) {
                $('#dt_top_users').DataTable({
                    "data": data,
                    "columns": [
                        {title: "Username", data: "twitter_handle"},
                        {title: "Tweets count", data: "count"},
                        {
                            title: "Date joined", data: "date_joined",
                            render: function (d) {
                                return moment(d).format("YYYY-MM-DD");
                            }
                        },
                    ],
                    "order": [[1, "desc"]],
                    "searching": false,
                    "info": false,
                    "lengthChange": false
                });

                var colors = ['#2196F3', '#FF5722', '#00BCD4', '#9C27B0', "#FF9800"];

                var chart = c3.generate({
                    bindto: '#c3_top_users',
                    data: {
                        {#url: 'ajaxtest',#}
                        {#mimeType: 'json',#}
                        json: data,
                        type: 'bar',
                        keys: {
                            x: 'twitter_handle',
                            value: ['count']
                        },
                        labels: true,
                        color: function (color, d) {
                            cc = d.index % 5;
                            return colors[cc];
                        }
                    },
                    axis: {
                        x: {
                            type: 'category'
                        }
                    },
                    bar: {
                        width: {
                            ratio: 0.5
                        }
                    },
                    legend: {
                        show: false
                    }
                });
            })


        });


    </script>
{% endblock %}
